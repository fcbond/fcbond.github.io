{% extends 'layout.html' %}

{% block css %}
  <link href="{{ url_for('static', filename='css/home.css') }}" rel="stylesheet">
{% endblock %}

  {% block content %}
{% macro ingredients_header() -%}
  <div class="d-flex flex-wrap align-items-center gap-2 mt-3 mb-2 recipe-scale">
    <h4 class="mb-0 me-2">Ingredients</h4>

    <div class="input-group input-group-sm" style="max-width: 170px;">
      <span class="input-group-text">×</span>
      <input
        type="number"
        class="form-control scaleFactor"
        value="1"
        min="0.1"
        step="0.1">
    </div>

    <div class="btn-group btn-group-sm" role="group" aria-label="Quick scale">
      <button type="button" class="btn btn-outline-secondary scale-btn" data-scale="0.5">0.5×</button>
      <button type="button" class="btn btn-outline-secondary scale-btn" data-scale="1">1×</button>
      <button type="button" class="btn btn-outline-secondary scale-btn" data-scale="2">2×</button>
      <button type="button" class="btn btn-outline-secondary scale-btn" data-scale="3">3×</button>
    </div>
  </div>
{%- endmacro %}


  
<div class="container">
  <h1>{{title}}</h1>
  <p>{{description}}</p>

  <!-- TOC (not scaled) -->
  <ul>
    <li>Main dishes
      <ul>
        <li><a href="#spare-ribs">Pork Spare Ribs in BBQ Sauce</a></li>
        <li><a href="#kalbi-chim">Kalbi Chim (Korean steamed beef ribs)</a></li>
        <li><a href="#farfollini">Farfalloni con Funghi (Bowties and Mushrooms)</a></li>
        <li><a href="#baked-beans">Baked Beans</a></li>
      </ul>
    </li>
    <li>Breakfast
      <ul>
        <li><a href="#porridge">Porridge (with dates and tahini)</a></li>
      </ul>
    </li>
    <li>Desserts
      <ul>
        <li><a href="#kentish-cake">Kentish Cake</a></li>
        <li><a href="#scones">Sultana Tea Scones</a></li>
        <li><a href="#pavlova">Classic Pavlova</a></li>
      </ul>
    </li>
  </ul>

  <h3 id="spare-ribs">Pork Spare Ribs in BBQ Sauce</h3>

  {{ ingredients_header() }}
  <p> For 4-5 people.</p>
  <ul class="ingredients">
    <li>500.0 g pork spare ribs (the thin ones are best)</li>
    <li>2 sweet potatoes</li>
    <li>2 large onions</li>
    <li>6 cloves garlic</li>
    <li>3 tbsp brown sugar</li>
    <li>3 tbsp vinegar</li>
    <li>1 tbsp mustard powder</li>
    <li>2 tbsp Worcestershire sauce</li>
    <li>1 tbsp tomato purée</li>
    <li>800.0 g canned tomatoes (two cans or 1000.0 g fresh tomatoes)</li>
  </ul>

<ol>
  <li> Put meat in baking tin without any oil.  Bake at 200C for 20-30
      min.  Pour off the fat that has come off the meat. 

  <li> While meat is cooking, prepare the sauce and cut the sweet
potatoes into smallish chunks.

  <li>Fry up onions and garlic and add ingredients in the order
listed.  Add some water if necessary - it should be thick but still
have plenty of liquid in order to keep the meat moist as it cooks.
Also taste, to adjust the sweet-sour-heat balance to taste.  Allow
sauce to cook gently, until the meat is read.  Then pour the fat off
the meat and add the sweet potatoes.  Finally pour the sauce onto the
meat and put back in the oven.

  <li>Reduce the heat to about 180C after about 20 minutes, but keep baking
for another 60 minutes.  Keep an eye on the cooking to make sure the
spare ribs do not burn.  If they are not completely covered with the
sauce, you may need to baste them (spoon up the sauce and put it over
the meat) a few times.

  <li>Serve with rice and some veggies. Amounts are enough to deal with
enough meat to feed 5 or so people.  If you have more, just multiply
the sauce up, and you might need to increase the cooking time a
little.  The meat should be soft and coming off the bones.  
</ol>


  <h3 id="kalbi-chim">Kalbi Chim (Korean steamed beef ribs)</h3>

  <p> Serves 5-6 people.</p>
  {{ ingredients_header() }}
  <ul class="ingredients">
    <li>1000.0 g beef ribs (slice through the ribs, in thin slices)</li>
    <li>1.5 cup water</li>
    <li>6 tbsp sugar(brown or white)</li>
    <li>1 tbsp rice wine (sake)</li>
    <li>6 tbsp soy sauce</li>
    <li>2 tbsp sesame seeds</li>
    <li>1 tbsp sesame oil</li>
    <li>0.5 large onion (grated)</li>
    <li>5 tbsp spring onions (chopped)</li>
    <li>2 pieces dark chocolate (melted)</li>
    <li>6 cloves garlic</li>
    <li>salt and pepper to taste</li>
  </ul>

<ol>
  <li> Soak the ribs in cold water to remove the blood:  leave in
      water for one hour, then throw the water away.
  <li> Put meat in shallow pan (best if it has thick base).  Mix all
      the other ingredients together, melting the chocolate so it will
      mix, and pour over the meat.
  <li> Simmer for more than one hour (maybe even two), until the meast
      is very tender and the sauce has thickened.
  <li> Serve with rice and kimchee.  If you have
      more, just multiply the sauce up, and you might need to increase
      the cooking time a little.   
  <li> If you have some leftovers, try mixing the rice in with the
      sauce when you heat them up.  It's delicious.
</ol>


  
  <h3 id="farfollini">Farfalloni con Funghi (Bowties and Mushrooms)</h3>

  {{ ingredients_header() }}
  <p>For 4 people</p>
  <ul class="ingredients">
    <li>40 g butter</li>
    <li>400 g mushrooms</li>
    <li>2 tbsp oil</li>
    <li>400 g minced pork</li>
    <li>1–2 cloves garlic (crushed)</li>
    <li>0.5 tsp dried basil</li>
    <li>0.5 tsp dried oregano</li>
    <li>salt and pepper (to taste)</li>
    <li>100.0 ml wine</li>
    <li>2 tbsp flour</li>
    <li>3 tbsp tomato purée</li>
    <li>200 ml beef stock</li>
    <li>300 g farfalloni</li>
    <li>freshly grated parmesan cheese</li>
  </ul>

  <ol>
<li>  In a saucepan melt the butter over medium heat and  saute the
    mushrooms until cooked.  Set aside.

<li> Heat the oil and brown the pork and garlic in it, breaking up any
    lumps with a wooden spoon.  (Pour off the juice and, if there is
    time, cool to remove the fat.)

<li> Turn up the heat and pour in the wine.  Let it boil rapidly until
    the foam subsides then add the flour stirring well.

<li>  Add the tomato puree, stock and herbs.  Stir well and leave to simmer
    over a low flame for about 25 minutes.  Stir quite often, as the
    sauce is thick and soon starts to stick to the bottom of the pan.
    When done add the reserved mushrooms and the juice from step 2.

<li>  Cook the farfalloni in plenty of boiling water (add salt when
    boiling) until al dente.  Drain.  To get the timing right, you
    need to put the water on about 10-15 minutes after the sauce
    started simmering.

<li>  Mix together the farfalloni and meat-mushroom sauce and serve
    immediately.  Pass the grated parmesan separately.
</ol>
<p>The sauce can be made hours in advance, just re-heat while the pasta
is cooking.  The sauce is also good with egg noodles of any width.</p>

<p>Adapted from <i>Pasta! Pasta! Pasta!</i> by Ursel Norman.</p>

<h3 id="baked-beans">Baked Beans</h3>

  <p>Serves 5-6 as main (with bread), 8-10 as side</p>
  {{ ingredients_header() }}
  <ul class="ingredients">
    <li>500.0 g dry white beans</li>
    <li>1 onion</li>
    <li>2 cloves</li>
    <li>4 slices smoky bacon</li>
    <li>1 onion</li>
    <li>400.0 g tomatoes</li>
    <li>1 tbsp brown sugar</li>
    <li>4 tbsp maple syrup (or less)</li>
    <li>2 tbsp Worcestershire sauce</li>
    <li>1 tbsp apple cider vinegar (optional)</li>
    <li>1 tsp salt</li>
    <li>0.tsp pepper</li>
    <li>1 bay leaf</li>
    <li>1 cup water</li>
  </ul>
<ul>
<li><b>Day 1</b>
<ol>
  <li>Soak beans 6-8 hours   (overnight) in cold water. </li>
</ol>
<li><b>Day 2</b>
<i>(Prep = ½ hour; Cooking = 4 hours)</i>
<ol>
  <li>Drain beans. Cover 
  with fresh cold water and add the onion stuck with cloves.</li>
  <li>Bring to the boil. </li>
  <li>Simmer for 1½ hours.</li>
  <li>Drain. Discard onion 
  and cloves.</li>
  <li>Preheat the oven    to 160 C (325 F). </li>
  <li>Dice bacon and onion.</li>
  <li>Sauté until the bacon is crisp and the onion soft.</li>
  <li>Place the beans, bacon, onion and remaining ingredients in a
  baking dish with the water and bake, covered, for 2 hours.</li>
  <li>(Optional) Stir, sprinkle with an extra tbsp of brown sugar, and
  bake 20 min uncovered, until the top glazes slightly.  </li>
</ol>
</ul>
<p>Adapted from Jill Dupleix's <i>Old Food</i> by Helena Bond, slight tweaks by Francis Bond.

  <h3 id="porridge">Porridge with Dates and Tahini</h3>
<p>Serves 2</p>
  {{ ingredients_header() }}
  <ul class="ingredients">
    <li>400.0 ml oat milk</li>
    <li>5.0 tbsp rolled oats</li>
    <li>1.5 tbsp chia seeds</li>
    <li>4 dates</li>
    <li>1 tbsp tahini</li>
  </ul>
<ol>
  <li>Place milk, salt, oats and chia seeds in a pot, bring to boil
  <li>Turn heat down and add dates, simmer for 5 minutes total, stirring occasionally, adding the tahini after 3 minutes
  <li>Serve with cream and nuts (almonds, walnuts, pistachios)
</ol>
  
 <p>Adapted from <i>The fast 800</i> by Michael Mosely (2019. p174) 

  <h3 id="kentish-cake">Kentish Cake</h3>

  {{ ingredients_header() }}
  <ul class="ingredients">
    <li>125 g butter</li>
    <li>0.75 cup sugar</li>
    <li>1 cup self-raising flour (or 1 tsp baking powder per cup of plain flour )</li>
    <li>2 tbsp coconut</li>
    <li>1 tbsp cocoa</li>
    <li>0.5 cup chopped nuts and sultanas combined
    <li>2 eggs</li>
    <li>0.25 cup milk</li>
  </ul>
<ol>	
  <li>Cream butter and sugar, add eggs one by one and beat well after each 
addition.  Mix in vanilla, then coconut and sifted flour and cocoa 
alternatively with milk.  Lastly add the fruit and nuts.

  <li>Spoon into deep loaf tin or ring tin which has been greased and 
papered and bake at 200C until a skewer inserted comes out clean. 
(about 30 minutes)
</ol>

 <p>From a recipe book from my primary school (Payne Road): cups are Australian (250 ml)</p>
 
  <h3 id="scones">Sultana Tea Scones</h3>

  {{ ingredients_header() }}
  <ul class="ingredients">
    <li>0.5 cup  plain flour</li>
    <li>2 tbsp butter</li>
    <li>2 tbsp sultanas</li>
    <li>1 tsp baking powder</li>
    <li>2 tbsp caster sugar</li>
    <li>4 tbsp milk</li>
  </ul>

  
<ol>
  <li> Grease the baking sheet
  <li> Sift plain flour with baking powder & caster sugar into mixing bowl
  <li> Cut butter into small pieces and rub into flour with fingers
  <li> Put sultanas into sieve with a little flour and shake.
  <li> Add sultanas to rubbed flour
  <li> Add the milk a tablespoon at a time, mixing with the hands to
      form a soft dough.
  <li> Turn on the oven at 230C (450F)
  <li> Sprinkle the table top lightly with flour and pat out the dough
      to a circle 1/2inch thick. Cut into triangles (or circles).
  <li> Put the scones on the greased baking sheet and bake in the top
      half of the oven for 5 - 10 minutes.  If they are not cooked right
      through, try at a lower temperature for longer (there is a lot
      of variation between ovens).
  <li> Serve hot or cold with butter and jam.
</ol>


  <h3 id="pavlova">Classic Pavlova</h3>

  {{ ingredients_header() }}
  <ul class="ingredients">
    <li>3 egg whites</li>
    <li>0.75 cup caster sugar</li>
    <li>0.25 cup granulated sugar</li>
    <li>1 tbsp cornflour</li>
    <li>1 tsp vinegar or lemon juice</li>
  </ul>

 <ol>
  <li>Beat egg whites and salt till stiff.  Beat in the castor sugar a 
little at a time until the mixture is stiff and shiny.

Mix the granulated sugar and cornflour together and fold into the 
mixture with the vinegar .  Vanilla essence can be added if desired.

  <li>Prepare a 20cm circle on greaseproof paper.  Grease it and put it on 
a greased biscuit tin,  Dust with cornflour.

  <li>Spread about 3/4 of the mixture over the prepared circle on the
tray. Pipe the rest of the mixture in shells or swirls around the
edge.  Bake in a slow oven (about 120 - 150C) for about 30 - 40
minutes.  This pavlova has a soft centre and a crisp exterior.
</ol> 

</div>
{% endblock %}

{% block js %}
<script>
(function($){

  function formatNumber(n) {
    const rounded = Math.round(n * 10) / 10;
    if (Math.abs(rounded - Math.round(rounded)) < 1e-9) return String(Math.round(rounded));
    return String(rounded.toFixed(1)).replace(/\.0$/, '');
  }

  function parseLeadingQuantity(text) {
    let t = (text || '').trim();

    // range like "1.0–2.0 cloves ..."
    let m = t.match(/^(\d+(?:\.\d+)?)\s*[–-]\s*(\d+(?:\.\d+)?)\s+(.*)$/);
    if (m) return { type: 'range', a: parseFloat(m[1]), b: parseFloat(m[2]), rest: m[3] };

    // single like "500.0 g ..."
    m = t.match(/^(\d+(?:\.\d+)?)\s+(.*)$/);
    if (!m) return null;
    return { type: 'single', a: parseFloat(m[1]), rest: m[2] };
  }

  function splitUnit(rest) {
    const m = (rest || '').trim().match(/^([^\s]+)\s*(.*)$/);
    if (!m) return { unit: '', tail: '' };
    return { unit: m[1], tail: m[2] || '' };
  }

  function initScaling() {
    const $lis = $('.ingredients li');
    if ($lis.length === 0) {
      console.warn("Recipe scaler: found 0 '.ingredients li' elements. Did you add class='ingredients' to the ULs?");
    }

    $lis.each(function(){
      const $li = $(this);
      if ($li.data('scaledInit')) return;

      const original = $li.text();
      const parsed = parseLeadingQuantity(original);
      if (!parsed) return;

      const { unit, tail } = splitUnit(parsed.rest);

      if (parsed.type === 'single') {
        const base = parsed.a;
        $li.html(
          `<span class="scaled-qty" data-kind="single" data-base="${base}">${formatNumber(base)}</span>` +
          ` ${unit}${tail ? ' ' + tail : ''}`
        );
      } else {
        const a = parsed.a, b = parsed.b;
        $li.html(
          `<span class="scaled-qty" data-kind="range" data-basemin="${a}" data-basemax="${b}">${formatNumber(a)}–${formatNumber(b)}</span>` +
          ` ${unit}${tail ? ' ' + tail : ''}`
        );
      }

      $li.data('scaledInit', true);
    });
  }

  function applyScale(factor) {
    factor = parseFloat(factor);
    if (!isFinite(factor) || factor <= 0) return;

    $('.scaled-qty').each(function(){
      const $s = $(this);
      const kind = $s.data('kind');

      if (kind === 'single') {
        const base = parseFloat($s.data('base'));
        $s.text(formatNumber(base * factor));
      } else {
        const baseMin = parseFloat($s.data('basemin'));
        const baseMax = parseFloat($s.data('basemax'));
        $s.text(`${formatNumber(baseMin * factor)}–${formatNumber(baseMax * factor)}`);
      }
    });
  }

  function setAllScales(factor) {
    $('.scaleFactor').val(factor);
    applyScale(factor);
  }

  $(function(){
    initScaling();

    const initial = $('.scaleFactor').first().val() || 1;
    setAllScales(initial);

    $(document).on('input change', '.scaleFactor', function(){
      setAllScales(this.value);
    });

    $(document).on('click', '.scale-btn', function(){
      setAllScales($(this).data('scale'));
    });
  });

})(jQuery);
</script>
{% endblock %}
